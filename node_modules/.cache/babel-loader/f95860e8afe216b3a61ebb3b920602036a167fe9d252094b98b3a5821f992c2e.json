{"ast":null,"code":"var _jsxFileName = \"E:\\\\secure-p2p-transfer\\\\frontend\\\\src\\\\Receiver.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { createPeerConnection, SIGNAL_SERVER } from \"./utils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Receiver() {\n  _s();\n  const [myId] = useState(Math.random().toString(36).substr(2, 8));\n  const [senderId, setSenderId] = useState(\"\");\n  const wsRef = useRef(null);\n  const peerRef = useRef(null);\n  const receivedBuffers = useRef([]);\n  const dataChannelRef = useRef(null);\n  useEffect(() => {\n    if (!senderId) return;\n    const ws = new WebSocket(SIGNAL_SERVER);\n    wsRef.current = ws;\n    ws.onopen = () => {\n      ws.send(JSON.stringify({\n        type: \"register\",\n        id: myId\n      }));\n    };\n    ws.onmessage = async msg => {\n      const data = JSON.parse(msg.data);\n      if (data.offer) {\n        if (!peerRef.current) {\n          peerRef.current = createPeerConnection();\n          setupPeerEvents(ws, peerRef.current);\n        }\n        await peerRef.current.setRemoteDescription(new RTCSessionDescription(data.offer));\n        const answer = await peerRef.current.createAnswer();\n        await peerRef.current.setLocalDescription(answer);\n        ws.send(JSON.stringify({\n          from: myId,\n          to: senderId,\n          answer\n        }));\n      }\n      if (data.ice && peerRef.current) {\n        await peerRef.current.addIceCandidate(data.ice);\n      }\n    };\n    return () => {\n      if (peerRef.current) peerRef.current.close();\n      if (wsRef.current) wsRef.current.close();\n    };\n  }, [senderId, myId]);\n\n  // Setup events for peer connection and data channel\n  const setupPeerEvents = (ws, peerConnection) => {\n    peerConnection.onicecandidate = e => {\n      if (e.candidate) {\n        ws.send(JSON.stringify({\n          from: myId,\n          to: senderId,\n          ice: e.candidate\n        }));\n      }\n    };\n    peerConnection.ondatachannel = event => {\n      const receiveChannel = event.channel;\n      dataChannelRef.current = receiveChannel;\n      receiveChannel.binaryType = \"arraybuffer\";\n      receiveChannel.onmessage = e => {\n        if (typeof e.data === \"string\" && e.data === \"EOF\") {\n          // Received entire file, save it\n          const blob = new Blob(receivedBuffers.current);\n          receivedBuffers.current = [];\n          const url = window.URL.createObjectURL(blob);\n          const a = document.createElement(\"a\");\n          a.style.display = \"none\";\n          a.href = url;\n          a.download = \"received_file\"; // Change filename if you want\n          document.body.appendChild(a);\n          a.click();\n          window.URL.revokeObjectURL(url);\n          a.remove();\n          console.log(\"File saved locally\");\n        } else {\n          receivedBuffers.current.push(e.data);\n          console.log(`Received chunk, size: ${e.data.byteLength || e.data.length}`);\n        }\n      };\n      receiveChannel.onopen = () => console.log(\"Data channel opened\");\n      receiveChannel.onclose = () => console.log(\"Data channel closed\");\n    };\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Receiver\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Your ID: \", /*#__PURE__*/_jsxDEV(\"b\", {\n        children: myId\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 19\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"text\",\n      placeholder: \"Enter Sender ID\",\n      value: senderId,\n      onChange: e => setSenderId(e.target.value.trim())\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Waiting for file from: \", /*#__PURE__*/_jsxDEV(\"b\", {\n        children: senderId || \"...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 33\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n}\n_s(Receiver, \"ZC38ymzeYaXJLa86LHorZuonU4E=\");\n_c = Receiver;\nexport default Receiver;\nvar _c;\n$RefreshReg$(_c, \"Receiver\");","map":{"version":3,"names":["React","useEffect","useRef","useState","createPeerConnection","SIGNAL_SERVER","jsxDEV","_jsxDEV","Receiver","_s","myId","Math","random","toString","substr","senderId","setSenderId","wsRef","peerRef","receivedBuffers","dataChannelRef","ws","WebSocket","current","onopen","send","JSON","stringify","type","id","onmessage","msg","data","parse","offer","setupPeerEvents","setRemoteDescription","RTCSessionDescription","answer","createAnswer","setLocalDescription","from","to","ice","addIceCandidate","close","peerConnection","onicecandidate","e","candidate","ondatachannel","event","receiveChannel","channel","binaryType","blob","Blob","url","window","URL","createObjectURL","a","document","createElement","style","display","href","download","body","appendChild","click","revokeObjectURL","remove","console","log","push","byteLength","length","onclose","children","fileName","_jsxFileName","lineNumber","columnNumber","placeholder","value","onChange","target","trim","_c","$RefreshReg$"],"sources":["E:/secure-p2p-transfer/frontend/src/Receiver.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport { createPeerConnection, SIGNAL_SERVER } from \"./utils\";\n\nfunction Receiver() {\n  const [myId] = useState(Math.random().toString(36).substr(2, 8));\n  const [senderId, setSenderId] = useState(\"\");\n  const wsRef = useRef(null);\n  const peerRef = useRef(null);\n  const receivedBuffers = useRef([]);\n  const dataChannelRef = useRef(null);\n\n  useEffect(() => {\n    if (!senderId) return;\n\n    const ws = new WebSocket(SIGNAL_SERVER);\n    wsRef.current = ws;\n\n    ws.onopen = () => {\n      ws.send(JSON.stringify({ type: \"register\", id: myId }));\n    };\n\n    ws.onmessage = async (msg) => {\n      const data = JSON.parse(msg.data);\n\n      if (data.offer) {\n        if (!peerRef.current) {\n          peerRef.current = createPeerConnection();\n          setupPeerEvents(ws, peerRef.current);\n        }\n\n        await peerRef.current.setRemoteDescription(new RTCSessionDescription(data.offer));\n        const answer = await peerRef.current.createAnswer();\n        await peerRef.current.setLocalDescription(answer);\n        ws.send(JSON.stringify({ from: myId, to: senderId, answer }));\n      }\n\n      if (data.ice && peerRef.current) {\n        await peerRef.current.addIceCandidate(data.ice);\n      }\n    };\n\n    return () => {\n      if (peerRef.current) peerRef.current.close();\n      if (wsRef.current) wsRef.current.close();\n    };\n  }, [senderId, myId]);\n\n  // Setup events for peer connection and data channel\n  const setupPeerEvents = (ws, peerConnection) => {\n    peerConnection.onicecandidate = (e) => {\n      if (e.candidate) {\n        ws.send(JSON.stringify({ from: myId, to: senderId, ice: e.candidate }));\n      }\n    };\n\n    peerConnection.ondatachannel = (event) => {\n      const receiveChannel = event.channel;\n      dataChannelRef.current = receiveChannel;\n      receiveChannel.binaryType = \"arraybuffer\";\n\n      receiveChannel.onmessage = (e) => {\n        if (typeof e.data === \"string\" && e.data === \"EOF\") {\n          // Received entire file, save it\n          const blob = new Blob(receivedBuffers.current);\n          receivedBuffers.current = [];\n\n          const url = window.URL.createObjectURL(blob);\n          const a = document.createElement(\"a\");\n          a.style.display = \"none\";\n          a.href = url;\n          a.download = \"received_file\"; // Change filename if you want\n          document.body.appendChild(a);\n          a.click();\n          window.URL.revokeObjectURL(url);\n          a.remove();\n\n          console.log(\"File saved locally\");\n        } else {\n          receivedBuffers.current.push(e.data);\n          console.log(`Received chunk, size: ${e.data.byteLength || e.data.length}`);\n        }\n      };\n\n      receiveChannel.onopen = () => console.log(\"Data channel opened\");\n      receiveChannel.onclose = () => console.log(\"Data channel closed\");\n    };\n  };\n\n  return (\n    <div>\n      <h2>Receiver</h2>\n      <p>Your ID: <b>{myId}</b></p>\n      <input\n        type=\"text\"\n        placeholder=\"Enter Sender ID\"\n        value={senderId}\n        onChange={(e) => setSenderId(e.target.value.trim())}\n      />\n      <p>Waiting for file from: <b>{senderId || \"...\"}</b></p>\n    </div>\n  );\n}\n\nexport default Receiver;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}