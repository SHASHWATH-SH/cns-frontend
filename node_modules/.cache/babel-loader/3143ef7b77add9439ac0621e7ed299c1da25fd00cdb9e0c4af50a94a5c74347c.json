{"ast":null,"code":"var _jsxFileName = \"E:\\\\secure-p2p-transfer\\\\frontend\\\\src\\\\Receiver.js\",\n  _s = $RefreshSig$();\n// Receiver.js\nimport React, { useState, useRef, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction generateId() {\n  return Math.random().toString(36).slice(2, 8).toUpperCase();\n}\nexport default function Receiver() {\n  _s();\n  const [id] = useState(generateId());\n  const [senderId, setSenderId] = useState('');\n  const [status, setStatus] = useState('Idle');\n  const pc = useRef(null);\n  const ws = useRef(null);\n  const dc = useRef(null);\n  const receivedBuffers = useRef([]);\n  const fileName = useRef('');\n  useEffect(() => {\n    ws.current = new WebSocket('s://172.17.1.95:8080');\n    ws.current.onopen = () => {\n      ws.current.send(JSON.stringify({\n        type: 'register',\n        id\n      }));\n      setStatus(`Registered as ${id}`);\n    };\n    ws.current.onmessage = async event => {\n      if (!pc.current) {\n        console.warn('pc.current is null, ignoring signaling message');\n        return;\n      }\n      const data = JSON.parse(event.data);\n      if (data.type === 'signal' && data.from === senderId) {\n        if (data.signal.sdp) {\n          await pc.current.setRemoteDescription(new RTCSessionDescription(data.signal));\n          if (data.signal.type === 'offer') {\n            const answer = await pc.current.createAnswer();\n            await pc.current.setLocalDescription(answer);\n            ws.current.send(JSON.stringify({\n              type: 'signal',\n              target: senderId,\n              signal: pc.current.localDescription\n            }));\n          }\n        } else if (data.signal.candidate) {\n          try {\n            await pc.current.addIceCandidate(new RTCIceCandidate(data.signal.candidate));\n          } catch (e) {\n            console.error('Error adding ICE candidate:', e);\n          }\n        }\n      }\n    };\n    return () => ws.current.close();\n  }, [id, senderId]);\n  const startConnection = () => {\n    pc.current = new RTCPeerConnection();\n    pc.current.ondatachannel = event => {\n      dc.current = event.channel;\n      dc.current.onopen = () => {\n        setStatus('Data channel open. Ready to receive file.');\n      };\n      dc.current.onmessage = event => {\n        if (typeof event.data === 'string') {\n          try {\n            const msg = JSON.parse(event.data);\n            if (msg.done) {\n              setStatus('File received completely. Saving...');\n              saveFile();\n            }\n          } catch {\n            // Not JSON, ignore\n          }\n        } else {\n          receivedBuffers.current.push(event.data);\n          setStatus(`Receiving... (${receivedBuffers.current.length} chunks)`);\n        }\n      };\n      dc.current.onclose = () => {\n        setStatus('Data channel closed.');\n      };\n    };\n    pc.current.onicecandidate = event => {\n      if (event.candidate) {\n        ws.current.send(JSON.stringify({\n          type: 'signal',\n          target: senderId,\n          signal: {\n            candidate: event.candidate\n          }\n        }));\n      }\n    };\n  };\n  const saveFile = () => {\n    const blob = new Blob(receivedBuffers.current);\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'received_file'; // You could customize or send filename from sender\n    document.body.appendChild(a);\n    a.click();\n    setTimeout(() => {\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    }, 100);\n    setStatus('File saved locally!');\n    receivedBuffers.current = [];\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: [\"Receiver (Your ID: \", id, \")\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"text\",\n      placeholder: \"Enter Sender ID\",\n      value: senderId,\n      onChange: e => setSenderId(e.target.value.toUpperCase())\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: startConnection,\n      disabled: !senderId,\n      children: \"Connect\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Status: \", status]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 5\n  }, this);\n}\n_s(Receiver, \"d47rPUQq991xl6EykdQSIoidy98=\");\n_c = Receiver;\nvar _c;\n$RefreshReg$(_c, \"Receiver\");","map":{"version":3,"names":["React","useState","useRef","useEffect","jsxDEV","_jsxDEV","generateId","Math","random","toString","slice","toUpperCase","Receiver","_s","id","senderId","setSenderId","status","setStatus","pc","ws","dc","receivedBuffers","fileName","current","WebSocket","onopen","send","JSON","stringify","type","onmessage","event","console","warn","data","parse","from","signal","sdp","setRemoteDescription","RTCSessionDescription","answer","createAnswer","setLocalDescription","target","localDescription","candidate","addIceCandidate","RTCIceCandidate","e","error","close","startConnection","RTCPeerConnection","ondatachannel","channel","msg","done","saveFile","push","length","onclose","onicecandidate","blob","Blob","url","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","setTimeout","removeChild","revokeObjectURL","children","_jsxFileName","lineNumber","columnNumber","placeholder","value","onChange","onClick","disabled","_c","$RefreshReg$"],"sources":["E:/secure-p2p-transfer/frontend/src/Receiver.js"],"sourcesContent":["// Receiver.js\nimport React, { useState, useRef, useEffect } from 'react';\n\nfunction generateId() {\n  return Math.random().toString(36).slice(2, 8).toUpperCase();\n}\n\nexport default function Receiver() {\n  const [id] = useState(generateId());\n  const [senderId, setSenderId] = useState('');\n  const [status, setStatus] = useState('Idle');\n  const pc = useRef(null);\n  const ws = useRef(null);\n  const dc = useRef(null);\n  const receivedBuffers = useRef([]);\n  const fileName = useRef('');\n\n  useEffect(() => {\n    ws.current = new WebSocket('s://172.17.1.95:8080');\n\n    ws.current.onopen = () => {\n      ws.current.send(JSON.stringify({ type: 'register', id }));\n      setStatus(`Registered as ${id}`);\n    };\n\n    ws.current.onmessage = async (event) => {\n        if (!pc.current) {\n    console.warn('pc.current is null, ignoring signaling message');\n    return;\n  }\n      const data = JSON.parse(event.data);\n      if (data.type === 'signal' && data.from === senderId) {\n        if (data.signal.sdp) {\n          await pc.current.setRemoteDescription(new RTCSessionDescription(data.signal));\n          if (data.signal.type === 'offer') {\n            const answer = await pc.current.createAnswer();\n            await pc.current.setLocalDescription(answer);\n            ws.current.send(JSON.stringify({\n              type: 'signal',\n              target: senderId,\n              signal: pc.current.localDescription,\n            }));\n          }\n        } else if (data.signal.candidate) {\n          try {\n            await pc.current.addIceCandidate(new RTCIceCandidate(data.signal.candidate));\n          } catch (e) {\n            console.error('Error adding ICE candidate:', e);\n          }\n        }\n      }\n    };\n\n    return () => ws.current.close();\n  }, [id, senderId]);\n\n  const startConnection = () => {\n    pc.current = new RTCPeerConnection();\n\n    pc.current.ondatachannel = (event) => {\n      dc.current = event.channel;\n\n      dc.current.onopen = () => {\n        setStatus('Data channel open. Ready to receive file.');\n      };\n\n      dc.current.onmessage = (event) => {\n        if (typeof event.data === 'string') {\n          try {\n            const msg = JSON.parse(event.data);\n            if (msg.done) {\n              setStatus('File received completely. Saving...');\n              saveFile();\n            }\n          } catch {\n            // Not JSON, ignore\n          }\n        } else {\n          receivedBuffers.current.push(event.data);\n          setStatus(`Receiving... (${receivedBuffers.current.length} chunks)`);\n        }\n      };\n\n      dc.current.onclose = () => {\n        setStatus('Data channel closed.');\n      };\n    };\n\n    pc.current.onicecandidate = (event) => {\n      if (event.candidate) {\n        ws.current.send(JSON.stringify({\n          type: 'signal',\n          target: senderId,\n          signal: { candidate: event.candidate },\n        }));\n      }\n    };\n  };\n\n  const saveFile = () => {\n    const blob = new Blob(receivedBuffers.current);\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'received_file';  // You could customize or send filename from sender\n    document.body.appendChild(a);\n    a.click();\n    setTimeout(() => {\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n    }, 100);\n    setStatus('File saved locally!');\n    receivedBuffers.current = [];\n  };\n\n  return (\n    <div>\n      <h2>Receiver (Your ID: {id})</h2>\n      <input\n        type=\"text\"\n        placeholder=\"Enter Sender ID\"\n        value={senderId}\n        onChange={(e) => setSenderId(e.target.value.toUpperCase())}\n      />\n      <button onClick={startConnection} disabled={!senderId}>Connect</button>\n      <p>Status: {status}</p>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}