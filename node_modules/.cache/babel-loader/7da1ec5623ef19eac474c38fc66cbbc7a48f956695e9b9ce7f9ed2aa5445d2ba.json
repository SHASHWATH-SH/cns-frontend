{"ast":null,"code":"var _jsxFileName = \"E:\\\\secure-p2p-transfer\\\\frontend\\\\src\\\\Sender.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction generateId() {\n  return Math.random().toString(36).substring(2, 8).toUpperCase();\n}\nexport default function Sender() {\n  _s();\n  const [senderId] = useState(generateId());\n  const [receiverId, setReceiverId] = useState(\"\");\n  const [file, setFile] = useState(null);\n  const ws = useRef(null);\n  const pc = useRef(null);\n  const dc = useRef(null);\n  useEffect(() => {\n    ws.current = new WebSocket(\"wss://localhost:8080\");\n    ws.current.onopen = () => console.log(\"Sender WebSocket connected\");\n    ws.current.onmessage = event => {\n      if (typeof event.data === \"string\") {\n        try {\n          const data = JSON.parse(event.data);\n          if (data.to !== senderId) return;\n          if (data.type === \"offer\") {\n            pc.current.setRemoteDescription(new RTCSessionDescription(data.offer)).then(() => pc.current.createAnswer()).then(answer => pc.current.setLocalDescription(answer)).then(() => {\n              ws.current.send(JSON.stringify({\n                to: data.from,\n                from: senderId,\n                type: \"answer\",\n                answer: pc.current.localDescription\n              }));\n            });\n          } else if (data.type === \"candidate\") {\n            pc.current.addIceCandidate(new RTCIceCandidate(data.candidate));\n          }\n        } catch {\n          console.error(\"Sender: Invalid JSON\");\n        }\n      }\n    };\n    return () => {\n      ws.current.close();\n      if (pc.current) pc.current.close();\n    };\n  }, [senderId]);\n  function startConnection() {\n    pc.current = new RTCPeerConnection();\n    dc.current = pc.current.createDataChannel(\"fileChannel\");\n    dc.current.onopen = () => {\n      console.log(\"Data channel open\");\n      if (file) sendFile();\n    };\n    dc.current.onclose = () => console.log(\"Data channel closed\");\n    pc.current.onicecandidate = event => {\n      if (event.candidate) {\n        ws.current.send(JSON.stringify({\n          to: receiverId,\n          from: senderId,\n          type: \"candidate\",\n          candidate: event.candidate\n        }));\n      }\n    };\n    pc.current.createOffer().then(offer => pc.current.setLocalDescription(offer)).then(() => {\n      ws.current.send(JSON.stringify({\n        to: receiverId,\n        from: senderId,\n        type: \"offer\",\n        offer: pc.current.localDescription\n      }));\n    });\n  }\n  function sendFile() {\n    if (!file) return;\n    const chunkSize = 16384;\n    const fileReader = new FileReader();\n    let offset = 0;\n    fileReader.addEventListener(\"error\", error => console.error(\"FileReader error:\", error));\n    fileReader.addEventListener(\"load\", e => {\n      dc.current.send(e.target.result);\n      offset += e.target.result.byteLength;\n      if (offset < file.size) {\n        readSlice(offset);\n      } else {\n        console.log(\"File sent successfully\");\n        dc.current.send(JSON.stringify({\n          done: true,\n          fileName: file.name\n        }));\n      }\n    });\n    const readSlice = o => {\n      const slice = file.slice(o, o + chunkSize);\n      fileReader.readAsArrayBuffer(slice);\n    };\n    readSlice(0);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: [\"Sender (ID: \", senderId, \")\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      placeholder: \"Enter Receiver ID\",\n      value: receiverId,\n      onChange: e => setReceiverId(e.target.value.toUpperCase())\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"file\",\n      onChange: e => setFile(e.target.files[0])\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: startConnection,\n      disabled: !receiverId || !file,\n      children: \"Connect & Send File\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 5\n  }, this);\n}\n_s(Sender, \"hEzKimZSxCWkW7ro1E7yRwH5VgQ=\");\n_c = Sender;\nvar _c;\n$RefreshReg$(_c, \"Sender\");","map":{"version":3,"names":["React","useState","useRef","useEffect","jsxDEV","_jsxDEV","generateId","Math","random","toString","substring","toUpperCase","Sender","_s","senderId","receiverId","setReceiverId","file","setFile","ws","pc","dc","current","WebSocket","onopen","console","log","onmessage","event","data","JSON","parse","to","type","setRemoteDescription","RTCSessionDescription","offer","then","createAnswer","answer","setLocalDescription","send","stringify","from","localDescription","addIceCandidate","RTCIceCandidate","candidate","error","close","startConnection","RTCPeerConnection","createDataChannel","sendFile","onclose","onicecandidate","createOffer","chunkSize","fileReader","FileReader","offset","addEventListener","e","target","result","byteLength","size","readSlice","done","fileName","name","o","slice","readAsArrayBuffer","children","_jsxFileName","lineNumber","columnNumber","placeholder","value","onChange","files","onClick","disabled","_c","$RefreshReg$"],"sources":["E:/secure-p2p-transfer/frontend/src/Sender.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\n\nfunction generateId() {\n  return Math.random().toString(36).substring(2, 8).toUpperCase();\n}\n\nexport default function Sender() {\n  const [senderId] = useState(generateId());\n  const [receiverId, setReceiverId] = useState(\"\");\n  const [file, setFile] = useState(null);\n  const ws = useRef(null);\n  const pc = useRef(null);\n  const dc = useRef(null);\n\n  useEffect(() => {\n    ws.current = new WebSocket(\"wss://localhost:8080\");\n    ws.current.onopen = () => console.log(\"Sender WebSocket connected\");\n    ws.current.onmessage = (event) => {\n      if (typeof event.data === \"string\") {\n        try {\n          const data = JSON.parse(event.data);\n          if (data.to !== senderId) return;\n\n          if (data.type === \"offer\") {\n            pc.current.setRemoteDescription(new RTCSessionDescription(data.offer))\n              .then(() => pc.current.createAnswer())\n              .then((answer) => pc.current.setLocalDescription(answer))\n              .then(() => {\n                ws.current.send(\n                  JSON.stringify({\n                    to: data.from,\n                    from: senderId,\n                    type: \"answer\",\n                    answer: pc.current.localDescription,\n                  })\n                );\n              });\n          } else if (data.type === \"candidate\") {\n            pc.current.addIceCandidate(new RTCIceCandidate(data.candidate));\n          }\n        } catch {\n          console.error(\"Sender: Invalid JSON\");\n        }\n      }\n    };\n\n    return () => {\n      ws.current.close();\n      if (pc.current) pc.current.close();\n    };\n  }, [senderId]);\n\n  function startConnection() {\n    pc.current = new RTCPeerConnection();\n\n    dc.current = pc.current.createDataChannel(\"fileChannel\");\n    dc.current.onopen = () => {\n      console.log(\"Data channel open\");\n      if (file) sendFile();\n    };\n    dc.current.onclose = () => console.log(\"Data channel closed\");\n\n    pc.current.onicecandidate = (event) => {\n      if (event.candidate) {\n        ws.current.send(\n          JSON.stringify({\n            to: receiverId,\n            from: senderId,\n            type: \"candidate\",\n            candidate: event.candidate,\n          })\n        );\n      }\n    };\n\n    pc.current.createOffer()\n      .then((offer) => pc.current.setLocalDescription(offer))\n      .then(() => {\n        ws.current.send(\n          JSON.stringify({\n            to: receiverId,\n            from: senderId,\n            type: \"offer\",\n            offer: pc.current.localDescription,\n          })\n        );\n      });\n  }\n\n  function sendFile() {\n    if (!file) return;\n    const chunkSize = 16384;\n    const fileReader = new FileReader();\n    let offset = 0;\n\n    fileReader.addEventListener(\"error\", (error) => console.error(\"FileReader error:\", error));\n    fileReader.addEventListener(\"load\", (e) => {\n      dc.current.send(e.target.result);\n      offset += e.target.result.byteLength;\n      if (offset < file.size) {\n        readSlice(offset);\n      } else {\n        console.log(\"File sent successfully\");\n        dc.current.send(JSON.stringify({ done: true, fileName: file.name }));\n      }\n    });\n\n    const readSlice = (o) => {\n      const slice = file.slice(o, o + chunkSize);\n      fileReader.readAsArrayBuffer(slice);\n    };\n\n    readSlice(0);\n  }\n\n  return (\n    <div>\n      <h2>Sender (ID: {senderId})</h2>\n      <input\n        placeholder=\"Enter Receiver ID\"\n        value={receiverId}\n        onChange={(e) => setReceiverId(e.target.value.toUpperCase())}\n      />\n      <br />\n      <input type=\"file\" onChange={(e) => setFile(e.target.files[0])} />\n      <br />\n      <button onClick={startConnection} disabled={!receiverId || !file}>\n        Connect & Send File\n      </button>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}