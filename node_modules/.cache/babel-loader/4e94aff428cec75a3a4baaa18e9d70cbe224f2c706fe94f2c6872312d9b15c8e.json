{"ast":null,"code":"var _jsxFileName = \"E:\\\\secure-p2p-transfer\\\\frontend\\\\src\\\\Receiver.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst generateId = () => Math.random().toString(36).substring(2, 8).toUpperCase();\nconst Receiver = () => {\n  _s();\n  const [id] = useState(generateId());\n  const ws = useRef(null);\n  const pc = useRef(null);\n  const [status, setStatus] = useState('Waiting for sender...');\n  const receivedChunks = useRef([]);\n  useEffect(() => {\n    ws.current = new WebSocket('wss://localhost:8080');\n    ws.current.onopen = () => {\n      ws.current.send(JSON.stringify({\n        type: 'register',\n        id\n      }));\n    };\n    ws.current.onmessage = event => {\n      try {\n        // Check if event.data is a string and likely JSON (starts with { or [)\n        if (typeof event.data === 'string' && (event.data.startsWith('{') || event.data.startsWith('['))) {\n          const data = JSON.parse(event.data);\n\n          // Handle signaling messages only here:\n          switch (data.type) {\n            case 'offer':\n              handleOffer(data.offer, data.sender);\n              break;\n            case 'candidate':\n              if (pc.current) {\n                pc.current.addIceCandidate(new RTCIceCandidate(data.candidate));\n              }\n              break;\n            case 'answer':\n              // Receiver usually doesn't get answer, but if so handle here\n              break;\n            default:\n              console.warn('Unknown signaling message type:', data.type);\n          }\n        } else {\n          // Not signaling message, might be data channel message (shouldn't come here, but just in case)\n          console.log('Non-JSON message received:', event.data);\n        }\n      } catch (err) {\n        console.error('Failed to parse message:', err, event.data);\n      }\n    };\n    return () => {\n      if (ws.current) ws.current.close();\n    };\n  }, [id]);\n  const handleOffer = async (offer, senderId) => {\n    pc.current = new RTCPeerConnection();\n    pc.current.ondatachannel = event => {\n      const channel = event.channel;\n      channel.binaryType = 'arraybuffer';\n      channel.onmessage = e => {\n        if (e.data === 'EOF') {\n          const blob = new Blob(receivedChunks.current);\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = 'received_file';\n          a.click();\n          URL.revokeObjectURL(url);\n          setStatus('File received and saved.');\n        } else {\n          receivedChunks.current.push(e.data);\n        }\n      };\n    };\n    pc.current.onicecandidate = e => {\n      if (e.candidate) {\n        ws.current.send(JSON.stringify({\n          type: 'candidate',\n          candidate: e.candidate,\n          target: senderId\n        }));\n      }\n    };\n    await pc.current.setRemoteDescription(new RTCSessionDescription(offer));\n    const answer = await pc.current.createAnswer();\n    await pc.current.setLocalDescription(answer);\n    ws.current.send(JSON.stringify({\n      type: 'answer',\n      answer,\n      target: senderId\n    }));\n    setStatus('Connection established. Receiving file...');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Receiver\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Your ID: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n        children: id\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 19\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Status: \", status]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 5\n  }, this);\n};\n_s(Receiver, \"UKMzCDTn6sIAnywkrefPad9UDz8=\");\n_c = Receiver;\nexport default Receiver;\nvar _c;\n$RefreshReg$(_c, \"Receiver\");","map":{"version":3,"names":["React","useEffect","useRef","useState","jsxDEV","_jsxDEV","generateId","Math","random","toString","substring","toUpperCase","Receiver","_s","id","ws","pc","status","setStatus","receivedChunks","current","WebSocket","onopen","send","JSON","stringify","type","onmessage","event","data","startsWith","parse","handleOffer","offer","sender","addIceCandidate","RTCIceCandidate","candidate","console","warn","log","err","error","close","senderId","RTCPeerConnection","ondatachannel","channel","binaryType","e","blob","Blob","url","URL","createObjectURL","a","document","createElement","href","download","click","revokeObjectURL","push","onicecandidate","target","setRemoteDescription","RTCSessionDescription","answer","createAnswer","setLocalDescription","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["E:/secure-p2p-transfer/frontend/src/Receiver.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\n\nconst generateId = () => Math.random().toString(36).substring(2, 8).toUpperCase();\n\nconst Receiver = () => {\n  const [id] = useState(generateId());\n  const ws = useRef(null);\n  const pc = useRef(null);\n  const [status, setStatus] = useState('Waiting for sender...');\n  const receivedChunks = useRef([]);\n\n  useEffect(() => {\n    ws.current = new WebSocket('wss://localhost:8080');\n\n    ws.current.onopen = () => {\n      ws.current.send(JSON.stringify({ type: 'register', id }));\n    };\n\n    ws.current.onmessage = (event) => {\n  try {\n    // Check if event.data is a string and likely JSON (starts with { or [)\n    if (typeof event.data === 'string' && (event.data.startsWith('{') || event.data.startsWith('['))) {\n      const data = JSON.parse(event.data);\n\n      // Handle signaling messages only here:\n      switch (data.type) {\n        case 'offer':\n          handleOffer(data.offer, data.sender);\n          break;\n        case 'candidate':\n          if (pc.current) {\n            pc.current.addIceCandidate(new RTCIceCandidate(data.candidate));\n          }\n          break;\n        case 'answer':\n          // Receiver usually doesn't get answer, but if so handle here\n          break;\n        default:\n          console.warn('Unknown signaling message type:', data.type);\n      }\n    } else {\n      // Not signaling message, might be data channel message (shouldn't come here, but just in case)\n      console.log('Non-JSON message received:', event.data);\n    }\n  } catch (err) {\n    console.error('Failed to parse message:', err, event.data);\n  }\n};\n\n\n    return () => {\n      if (ws.current) ws.current.close();\n    };\n  }, [id]);\n\n  const handleOffer = async (offer, senderId) => {\n    pc.current = new RTCPeerConnection();\n\n    pc.current.ondatachannel = (event) => {\n      const channel = event.channel;\n      channel.binaryType = 'arraybuffer';\n\n      channel.onmessage = (e) => {\n        if (e.data === 'EOF') {\n          const blob = new Blob(receivedChunks.current);\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = 'received_file';\n          a.click();\n          URL.revokeObjectURL(url);\n          setStatus('File received and saved.');\n        } else {\n          receivedChunks.current.push(e.data);\n        }\n      };\n    };\n\n    pc.current.onicecandidate = (e) => {\n      if (e.candidate) {\n        ws.current.send(JSON.stringify({ type: 'candidate', candidate: e.candidate, target: senderId }));\n      }\n    };\n\n    await pc.current.setRemoteDescription(new RTCSessionDescription(offer));\n    const answer = await pc.current.createAnswer();\n    await pc.current.setLocalDescription(answer);\n\n    ws.current.send(JSON.stringify({ type: 'answer', answer, target: senderId }));\n    setStatus('Connection established. Receiving file...');\n  };\n\n  return (\n    <div>\n      <h2>Receiver</h2>\n      <p>Your ID: <strong>{id}</strong></p>\n      <p>Status: {status}</p>\n    </div>\n  );\n};\n\nexport default Receiver;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}