{"ast":null,"code":"var _jsxFileName = \"E:\\\\secure-p2p-transfer\\\\frontend\\\\src\\\\components\\\\Sender.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport { QRCodeSVG } from 'qrcode.react';\nimport { createPeerConnection, SIGNAL_SERVER } from '../utils';\nimport { v4 as uuidv4 } from 'uuid';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Sender() {\n  _s();\n  const [id] = useState(uuidv4());\n  const [qrValue, setQRValue] = useState('');\n  const wsRef = useRef(null);\n  const peerRef = useRef(null);\n  useEffect(() => {\n    const ws = new WebSocket(SIGNAL_SERVER);\n    wsRef.current = ws;\n    peerRef.current = createPeerConnection();\n    peerRef.current.onicecandidate = e => {\n      if (e.candidate) {\n        ws.send(JSON.stringify({\n          from: id,\n          to: qrValue,\n          ice: e.candidate\n        }));\n      }\n    };\n    peerRef.current.ondatachannel = e => {\n      const receiveChannel = e.channel;\n      receiveChannel.onmessage = e => {\n        console.log('Received: ', e.data);\n      };\n    };\n    ws.onmessage = async msg => {\n      const data = JSON.parse(msg.data);\n      if (data.answer) {\n        await peerRef.current.setRemoteDescription(new RTCSessionDescription(data.answer));\n      }\n      if (data.ice) {\n        await peerRef.current.addIceCandidate(data.ice);\n      }\n    };\n    const channel = peerRef.current.createDataChannel('file');\n    channel.onopen = () => {\n      console.log('Data channel open');\n    };\n    channel.onmessage = e => {\n      console.log('Received:', e.data);\n    };\n    peerRef.current.createOffer().then(offer => {\n      return peerRef.current.setLocalDescription(offer);\n    }).then(() => {\n      setQRValue(id);\n    });\n  }, [id]);\n  useEffect(() => {\n    if (peerRef.current && peerRef.current.localDescription && wsRef.current.readyState === 1) {\n      wsRef.current.send(JSON.stringify({\n        from: id,\n        offer: peerRef.current.localDescription\n      }));\n    }\n  }, [qrValue]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Sender\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Scan this QR on Receiver device\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this), qrValue && /*#__PURE__*/_jsxDEV(QRCodeSVG, {\n      value: qrValue\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 19\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 65,\n    columnNumber: 5\n  }, this);\n}\n_s(Sender, \"a7mgHY4ULu6OFKqGIwiXeuGA0ng=\");\n_c = Sender;\nexport default Sender;\nvar _c;\n$RefreshReg$(_c, \"Sender\");","map":{"version":3,"names":["React","useState","useRef","useEffect","QRCodeSVG","createPeerConnection","SIGNAL_SERVER","v4","uuidv4","jsxDEV","_jsxDEV","Sender","_s","id","qrValue","setQRValue","wsRef","peerRef","ws","WebSocket","current","onicecandidate","e","candidate","send","JSON","stringify","from","to","ice","ondatachannel","receiveChannel","channel","onmessage","console","log","data","msg","parse","answer","setRemoteDescription","RTCSessionDescription","addIceCandidate","createDataChannel","onopen","createOffer","then","offer","setLocalDescription","localDescription","readyState","children","fileName","_jsxFileName","lineNumber","columnNumber","value","_c","$RefreshReg$"],"sources":["E:/secure-p2p-transfer/frontend/src/components/Sender.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { QRCodeSVG } from 'qrcode.react';\nimport { createPeerConnection, SIGNAL_SERVER } from '../utils';\nimport { v4 as uuidv4 } from 'uuid';\n\nfunction Sender() {\n  const [id] = useState(uuidv4());\n  const [qrValue, setQRValue] = useState('');\n  const wsRef = useRef(null);\n  const peerRef = useRef(null);\n\n  useEffect(() => {\n    const ws = new WebSocket(SIGNAL_SERVER);\n    wsRef.current = ws;\n\n    peerRef.current = createPeerConnection();\n\n    peerRef.current.onicecandidate = e => {\n      if (e.candidate) {\n        ws.send(JSON.stringify({ from: id, to: qrValue, ice: e.candidate }));\n      }\n    };\n\n    peerRef.current.ondatachannel = e => {\n      const receiveChannel = e.channel;\n      receiveChannel.onmessage = e => {\n        console.log('Received: ', e.data);\n      };\n    };\n\n    ws.onmessage = async msg => {\n      const data = JSON.parse(msg.data);\n      if (data.answer) {\n        await peerRef.current.setRemoteDescription(new RTCSessionDescription(data.answer));\n      }\n      if (data.ice) {\n        await peerRef.current.addIceCandidate(data.ice);\n      }\n    };\n\n    const channel = peerRef.current.createDataChannel('file');\n    channel.onopen = () => {\n      console.log('Data channel open');\n    };\n    channel.onmessage = e => {\n      console.log('Received:', e.data);\n    };\n\n    peerRef.current.createOffer()\n      .then(offer => {\n        return peerRef.current.setLocalDescription(offer);\n      })\n      .then(() => {\n        setQRValue(id);\n      });\n  }, [id]);\n\n  useEffect(() => {\n    if (peerRef.current && peerRef.current.localDescription && wsRef.current.readyState === 1) {\n      wsRef.current.send(JSON.stringify({ from: id, offer: peerRef.current.localDescription }));\n    }\n  }, [qrValue]);\n\n  return (\n    <div>\n      <h2>Sender</h2>\n      <p>Scan this QR on Receiver device</p>\n      {qrValue && <QRCodeSVG value={qrValue} />}\n      \n    </div>\n  );\n}\n\nexport default Sender;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}