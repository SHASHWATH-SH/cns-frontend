{"ast":null,"code":"var _jsxFileName = \"E:\\\\secure-p2p-transfer\\\\frontend\\\\src\\\\Receiver.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction randomId() {\n  return Math.random().toString(36).substring(2, 8).toUpperCase();\n}\nexport default function Receiver() {\n  _s();\n  const [receiverId] = useState(randomId());\n  const [senderId, setSenderId] = useState(\"\");\n  const ws = useRef(null);\n  const pc = useRef(null);\n  const dc = useRef(null);\n  const receivedBuffers = useRef([]);\n  const [fileName, setFileName] = useState(\"\");\n  const [downloadUrl, setDownloadUrl] = useState(null);\n  useEffect(() => {\n    ws.current = new WebSocket(\"wss://localhost:8080\");\n    ws.current.onopen = () => {\n      console.log(\"Receiver WebSocket connected\");\n    };\n    ws.current.onmessage = async event => {\n      const data = JSON.parse(event.data);\n      if (data.to !== receiverId) return;\n      if (data.type === \"offer\") {\n        await pc.current.setRemoteDescription(data.offer);\n        const answer = await pc.current.createAnswer();\n        await pc.current.setLocalDescription(answer);\n        ws.current.send(JSON.stringify({\n          from: receiverId,\n          to: data.from,\n          type: \"answer\",\n          answer\n        }));\n      } else if (data.type === \"candidate\") {\n        try {\n          await pc.current.addIceCandidate(data.candidate);\n        } catch (e) {\n          console.error(\"Error adding ICE candidate\", e);\n        }\n      }\n    };\n    return () => {\n      ws.current.close();\n    };\n  }, [receiverId]);\n  useEffect(() => {\n    pc.current = new RTCPeerConnection();\n    pc.current.onicecandidate = e => {\n      if (e.candidate) {\n        ws.current.send(JSON.stringify({\n          from: receiverId,\n          to: senderId,\n          type: \"candidate\",\n          candidate: e.candidate\n        }));\n      }\n    };\n    pc.current.ondatachannel = e => {\n      dc.current = e.channel;\n      dc.current.binaryType = \"arraybuffer\";\n      dc.current.onopen = () => {\n        console.log(\"Receiver DataChannel open\");\n      };\n      dc.current.onclose = () => {\n        console.log(\"Receiver DataChannel closed\");\n      };\n      dc.current.onmessage = event => {\n        if (typeof event.data === \"string\") {\n          // Control message\n          try {\n            const msg = JSON.parse(event.data);\n            if (msg.done) {\n              console.log(\"Received done message, assembling file...\");\n              const blob = new Blob(receivedBuffers.current);\n              receivedBuffers.current = [];\n              setFileName(msg.fileName);\n              const url = URL.createObjectURL(blob);\n              setDownloadUrl(url);\n            }\n          } catch (err) {\n            console.error(\"Failed to parse control message:\", err);\n          }\n        } else {\n          // Binary chunk\n          console.log(\"Received chunk size:\", event.data.byteLength);\n          receivedBuffers.current.push(event.data);\n        }\n      };\n    };\n  }, [receiverId, senderId]);\n\n  // Auto-download when downloadUrl is set\n  useEffect(() => {\n    if (downloadUrl) {\n      const a = document.createElement(\"a\");\n      a.href = downloadUrl;\n      a.download = fileName || \"file.bin\";\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      URL.revokeObjectURL(downloadUrl);\n      setDownloadUrl(null);\n      setFileName(\"\");\n    }\n  }, [downloadUrl, fileName]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: 20\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: [\"Receiver ID: \", receiverId]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      placeholder: \"Enter Sender ID\",\n      value: senderId,\n      onChange: e => setSenderId(e.target.value.toUpperCase()),\n      maxLength: 6,\n      style: {\n        textTransform: \"uppercase\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Share this ID with sender: \", /*#__PURE__*/_jsxDEV(\"b\", {\n        children: receiverId\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 37\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 124,\n    columnNumber: 5\n  }, this);\n}\n_s(Receiver, \"WPNhYC6AOvkZP4UNWLJ+ynpRX8s=\");\n_c = Receiver;\nvar _c;\n$RefreshReg$(_c, \"Receiver\");","map":{"version":3,"names":["React","useState","useRef","useEffect","jsxDEV","_jsxDEV","randomId","Math","random","toString","substring","toUpperCase","Receiver","_s","receiverId","senderId","setSenderId","ws","pc","dc","receivedBuffers","fileName","setFileName","downloadUrl","setDownloadUrl","current","WebSocket","onopen","console","log","onmessage","event","data","JSON","parse","to","type","setRemoteDescription","offer","answer","createAnswer","setLocalDescription","send","stringify","from","addIceCandidate","candidate","e","error","close","RTCPeerConnection","onicecandidate","ondatachannel","channel","binaryType","onclose","msg","done","blob","Blob","url","URL","createObjectURL","err","byteLength","push","a","document","createElement","href","download","body","appendChild","click","remove","revokeObjectURL","style","padding","children","_jsxFileName","lineNumber","columnNumber","placeholder","value","onChange","target","maxLength","textTransform","_c","$RefreshReg$"],"sources":["E:/secure-p2p-transfer/frontend/src/Receiver.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\n\nfunction randomId() {\n  return Math.random().toString(36).substring(2, 8).toUpperCase();\n}\n\nexport default function Receiver() {\n  const [receiverId] = useState(randomId());\n  const [senderId, setSenderId] = useState(\"\");\n  const ws = useRef(null);\n  const pc = useRef(null);\n  const dc = useRef(null);\n  const receivedBuffers = useRef([]);\n  const [fileName, setFileName] = useState(\"\");\n  const [downloadUrl, setDownloadUrl] = useState(null);\n\n  useEffect(() => {\n    ws.current = new WebSocket(\"wss://localhost:8080\");\n\n    ws.current.onopen = () => {\n      console.log(\"Receiver WebSocket connected\");\n    };\n\n    ws.current.onmessage = async (event) => {\n      const data = JSON.parse(event.data);\n      if (data.to !== receiverId) return;\n\n      if (data.type === \"offer\") {\n        await pc.current.setRemoteDescription(data.offer);\n        const answer = await pc.current.createAnswer();\n        await pc.current.setLocalDescription(answer);\n        ws.current.send(\n          JSON.stringify({\n            from: receiverId,\n            to: data.from,\n            type: \"answer\",\n            answer,\n          })\n        );\n      } else if (data.type === \"candidate\") {\n        try {\n          await pc.current.addIceCandidate(data.candidate);\n        } catch (e) {\n          console.error(\"Error adding ICE candidate\", e);\n        }\n      }\n    };\n\n    return () => {\n      ws.current.close();\n    };\n  }, [receiverId]);\n\n  useEffect(() => {\n    pc.current = new RTCPeerConnection();\n\n    pc.current.onicecandidate = (e) => {\n      if (e.candidate) {\n        ws.current.send(\n          JSON.stringify({\n            from: receiverId,\n            to: senderId,\n            type: \"candidate\",\n            candidate: e.candidate,\n          })\n        );\n      }\n    };\n\n    pc.current.ondatachannel = (e) => {\n      dc.current = e.channel;\n\n      dc.current.binaryType = \"arraybuffer\";\n\n      dc.current.onopen = () => {\n        console.log(\"Receiver DataChannel open\");\n      };\n\n      dc.current.onclose = () => {\n        console.log(\"Receiver DataChannel closed\");\n      };\n\n      dc.current.onmessage = (event) => {\n        if (typeof event.data === \"string\") {\n          // Control message\n          try {\n            const msg = JSON.parse(event.data);\n            if (msg.done) {\n              console.log(\"Received done message, assembling file...\");\n              const blob = new Blob(receivedBuffers.current);\n              receivedBuffers.current = [];\n              setFileName(msg.fileName);\n              const url = URL.createObjectURL(blob);\n              setDownloadUrl(url);\n            }\n          } catch (err) {\n            console.error(\"Failed to parse control message:\", err);\n          }\n        } else {\n          // Binary chunk\n          console.log(\"Received chunk size:\", event.data.byteLength);\n          receivedBuffers.current.push(event.data);\n        }\n      };\n    };\n  }, [receiverId, senderId]);\n\n  // Auto-download when downloadUrl is set\n  useEffect(() => {\n    if (downloadUrl) {\n      const a = document.createElement(\"a\");\n      a.href = downloadUrl;\n      a.download = fileName || \"file.bin\";\n      document.body.appendChild(a);\n      a.click();\n      a.remove();\n      URL.revokeObjectURL(downloadUrl);\n      setDownloadUrl(null);\n      setFileName(\"\");\n    }\n  }, [downloadUrl, fileName]);\n\n  return (\n    <div style={{ padding: 20 }}>\n      <h2>Receiver ID: {receiverId}</h2>\n      <input\n        placeholder=\"Enter Sender ID\"\n        value={senderId}\n        onChange={(e) => setSenderId(e.target.value.toUpperCase())}\n        maxLength={6}\n        style={{ textTransform: \"uppercase\" }}\n      />\n      <br />\n      <p>Share this ID with sender: <b>{receiverId}</b></p>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}